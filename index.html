<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="icon" href="#" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Markazi+Text|Noto+Serif:400,400i&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Noto Serif", serif;
      }
      input,
      .persian {
        font-family: "Markazi Text", serif !important;
      }
      input:read-only {
        background-color: white !important;
      }
      input:-moz-read-only {
        background-color: white !important;
      }
    </style>
    <title>The Kam-sala Cipher</title>
  </head>
  <body>
    <div class="container" style="margin-top:.5rem;max-width:74ch">
      <h1>The <em>Kam-sala</em> Cipher</h1>
      <p>
        This was once a fairly common way of concealing the meaning of text in
        Persian. I first came across discussion of it in Safavid-era sources,
        but it is also mentioned, in a slightly different form, in the
        <em>Subh al-a‘sha</em> of al-Qalqashandi (d. 1418 CE). So it’s clear
        that the history of this cipher goes back at least six centuries, and
        that it also saw some use in Arabic.
      </p>
      <p>
        A <a href="img/shakespear.png">concise description</a> of the
        <em>kam-sala</em> system is given in the Hindustani dictionary of John
        Shakespear (d. 1858). The rules are also explained below. But enough of
        this rambling! I put together a simple utility that will apply the
        cipher to any Persian or Arabic text that you enter. It runs in
        client-side JavaScript. The source files are available
        <a
          href="https://github.com/theodore-s-beers/kam-sala"
          target="_blank"
          rel="noopener"
          >on GitHub</a
        >. Hopefully this will be an amusement to someone!
      </p>
      <hr />
      <h2>Plaintext</h2>
      <form action="JavaScript:cipher();">
        <input
          class="form-control form-control-lg"
          placeholder="اینجا چیزی بنویسید"
          lang="ar"
          dir="rtl"
          autocomplete="off"
          id="plaintext"
          pattern="[\u0600-\u06ff]+(\s+[\u0600-\u06ff]+)*"
        />
        <button
          type="submit"
          class="btn btn-primary"
          style="margin-top:1rem;margin-right:1rem"
        >
          Submit</button
        ><button
          id="resetButton"
          type="button"
          class="btn btn-secondary"
          style="margin-top:1rem"
        >
          Reset
        </button>
      </form>
      <h2 style="margin-top:1.2rem">Ciphertext</h2>
      <form>
        <input
          class="form-control form-control-lg"
          placeholder="نتیجه اینجا ظاهر می‌شود"
          lang="ar"
          dir="rtl"
          autocomplete="off"
          id="ciphertext"
          readonly="readonly"
        />
        <button
          id="copyButton"
          type="button"
          class="btn btn-success"
          data-toggle="tooltip"
          data-delay='{"hide":"1000"}'
          style="margin-top:1rem;"
        >
          Copy
        </button>
      </form>
      <hr />
      <h2>Rules</h2>
      <p>
        The cipher is applied according to the following mnemonic (a line of
        poetry in the <em>khafif</em> meter):
      </p>
      <p class="persian" style="font-size:large">
        <span>کم صلا او حط له در سع</span><br /><span
          >حرف منقوط را به جایش دع</span
        >
      </p>
      <p>
        The first hemistich lists the letters that should be swapped:
        <em>kaf</em> for <em>mim</em> (and <em>vice versa</em>);
        <em>sad</em> for <em>lam alif</em> (this is a unique case where one
        letter is exchanged for two, and <em>vice versa</em>); <em>alif</em> for
        <em>waw</em> (and <em>vice versa</em>); <em>etc</em>.
      </p>
      <p>
        The second hemistich specifies that letters with dots should be left
        as-is.
      </p>
      <p>
        For example, the word <span class="persian">سلامت</span> would become
        <span class="persian">عصکت</span> in ciphertext.
      </p>
      <p>
        To decrypt a message, simply run it through the cipher again. It should
        go without saying that a system this simple will offer little security,
        except perhaps
        <a
          href="https://en.wikipedia.org/wiki/Security_through_obscurity"
          target="_blank"
          rel="noopener"
          >through obscurity</a
        >.
      </p>
      <hr />
      <h2>Further reading</h2>
      <ul class="list-group" style="margin-top:1rem">
        <li class="list-group-item">
          A
          <a
            href="http://rpll.ui.ac.ir/article_19305.html"
            target="_blank"
            rel="noopener"
            >journal article</a
          >
          (in Persian) by Muhsin Muhammadi Fasharaki and Maryam Shirani, which
          reviews a number of historical methods for passing secrets in text,
          including <em>kam-sala</em>
        </li>
        <li class="list-group-item">
          The
          <a
            href="https://vajehyab.com/dehkhoda/%DA%A9%D9%85+%D8%B5%D9%84%D8%A7"
            target="_blank"
            rel="noopener"
            >entry</a
          >
          on <em>kam-sala</em> in the dictionary of Dehkhoda
        </li>
        <li class="list-group-item">
          Another <a href="img/leitner.png">description</a> of the
          <em>kam-sala</em> cipher by a European orientalist, in this case
          Gottlieb Wilhelm Leitner (d. 1899)
        </li>
      </ul>
      <hr />
      <p>
        Made with coffee and pedantry by
        <a href="https://www.theobeers.com/">Theo Beers</a><br /><em
          >Last updated 19 Jan. 2020</em
        >
      </p>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
    <script src="js/kam-sala.js"></script>
    <script>
      $("#resetButton").on("click", reset);
    </script>
    <script>
      const result = document.getElementById("ciphertext");
      function copyResult() {
        if (result.value.length > 0) {
          result.select();
          result.setSelectionRange(0, 99999);
          document.execCommand("copy");
          document.getSelection().removeAllRanges();
          document.getElementById("ciphertext").blur();
          $("#copyButton").tooltip("enable");
          $("#copyButton")
            .attr("data-original-title", "Copied")
            .tooltip("show");
          $("#copyButton").tooltip("disable");
        }
      }
      $("#copyButton").on("click", copyResult);
    </script>
  </body>
</html>
